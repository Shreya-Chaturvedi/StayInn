<style>
  .custom-card {
    /* background: #ffffff;  */
    /* color: #212529;  */
    border-radius: 1rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
  }
  .custom-card:hover {
    transform: translateY(-5px);
  }

  .review-item {
    background: #f8f9fa; /* Light mode */
    color: #212529;
  }

  body.dark-mode .review-item {
    background: #2b2b2b; /* Dark mode */
    color: #eaeaea;
  }

  .review-item {
    background: #f8f9fa;
    padding: 10px;
    font-size: 14px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #sentimentChart {
    max-width: 100%;
    height: 300px !important; /* ya jo height chahiye */
  }

  /* âœ… Mobile fix */
  @media (max-width: 576px) {
    .review-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
    }

    .review-item span:last-child {
      align-self: flex-end;
    }
  }
</style>

<% layout("layouts/boilerplate") -%>

<h2 class="mb-4 text-center fw-bold">My Listings</h2>

<!-- ðŸ”¹ Sentiment Analysis Summary Section -->
<div class="card shadow-lg border-0 rounded-4 mb-5 p-4">
  <h3 class="text-center text-success mb-3">Sentiment Analysis Summary</h3>

  <div class="text-center">
    <p><b>Positive Reviews:</b> <%= positive %></p>
    <p><b>Negative Reviews:</b> <%= negative %></p>
    <p><b>Neutral Reviews:</b> <%= neutral %></p>
  </div>

  <div
    class="d-flex justify-content-center"
    style="max-width: 400px; margin: 0 auto"
  >
    <canvas id="sentimentChart"></canvas>
  </div>
</div>

<div class="row">
  <% listingsWithSentiment.forEach(({ listing, overall }) => { %>
  <div class="col-md-6 col-lg-4 mb-4">
    <div class="card shadow-lg border-0 rounded-4 h-100">
      <div class="card-body p-4">
        <h4 class="card-title text-primary mb-2"><%= listing.title %></h4>
        <p><%= listing.description %></p>

        <p class="fw-semibold mt-3">
          <span>Overall Sentiment: </span>
          <span
            class="<%= overall.includes('Positive') ? 'text-success' : overall.includes('Negative') ? 'text-danger' : 'text-secondary' %>"
          >
            <%= overall %>
          </span>
        </p>

        <h6 class="mt-4 text-secondary">Reviews:</h6>
        <ul class="list-unstyled">
          <% listing.reviews.forEach(review => { %>
          <li
            class="mb-2 p-2 rounded d-flex justify-content-between align-items-center"
          >
            <span>
              <b>@<%= review.author.username %></b>: <%= review.comment %>
            </span>
            <span
              class="badge <%= review.sentiment === 'Positive' ? 'bg-success' : review.sentiment === 'Negative' ? 'bg-danger' : 'bg-secondary' %>"
            >
              <%= review.sentiment %>
            </span>
          </li>
          <% }) %>
        </ul>
      </div>
    </div>
  </div>
  <% }) %>
</div>

<script type="application/json" id="sentiment-json">
  <%- JSON.stringify({ positive, negative, neutral }) %>
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Read JSON injected by EJS
  const { positive, negative, neutral } = JSON.parse(
    document.getElementById("sentiment-json").textContent
  );

  const ctx = document.getElementById("sentimentChart").getContext("2d");
  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Positive", "Negative", "Neutral"],
      datasets: [
        {
          data: [positive, negative, neutral],
          backgroundColor: ["#28a745", "#dc3545", "#6c757d"],
        },
      ],
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "bottom" } },
    },
  });
</script>
